<?xml version="1.0" encoding="windows-1250"?>
<project name="Esselte - Esselte - Nightly Build">
    <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB</workingDirectory>
    <artifactDirectory>c:\CCNet_Artefacts_Directory\Esselte\Esselte_Stable_NB</artifactDirectory>
    <webURL>http://vmp-ccnet.fcuk.local/server/local/project/Esselte - Nightly Build/ViewProjectReport.aspx</webURL>
    <category>Nightly Build</category>

	<triggers>
		<scheduleTrigger time="23:30:00" buildCondition="ForceBuild">
			<weekDays>
				<weekDay>Monday</weekDay>
				<weekDay>Tuesday</weekDay>
				<weekDay>Wednesday</weekDay>
				<weekDay>Thursday</weekDay>
				<weekDay>Sunday</weekDay>
			</weekDays>
		</scheduleTrigger>
	</triggers>
 
    <labeller type="assemblyVersionLabeller">
        <major>1</major>
        <minor>1</minor>
        <build>0</build>
        <incrementOnFailure>false</incrementOnFailure>
    </labeller>

    <publishers>
        <xmllogger logDir="buildlogs" />
        <artifactcleanup cleanUpMethod="KeepLastXBuilds" cleanUpValue="10" />
        <rss items="10" />
    </publishers>

    <sourcecontrol type="svn">
        <trunkUrl>svn://vm-svn.fcdev.local/enp/trunk/Esselte Stable</trunkUrl>
        <username>dev.tools</username>
        <password>KL129377</password>
        <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB</workingDirectory>
        <executable>C:\Program Files\CollabNet\Subversion Client\svn.exe</executable>
    </sourcecontrol>

    <tasks>
		 <!-- Generate assembly information -->
		<msbuild>
		  <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
		  <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB</workingDirectory>
		  <projectFile>CreateAssemblyInfo.proj</projectFile>
		  <buildArgs>/v:diag  /p:Configuration=PRE-PROD</buildArgs>
		  <targets>CreateAssemblyInfo</targets>
		  <timeout>9000</timeout>
		  <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
		</msbuild>

        <!-- build project using PRE-PROD configuration to generate config transformations-->
        <msbuild>
            <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
            <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB</workingDirectory>
            <projectFile>Esselte.Stable.sln</projectFile>
            <buildArgs>/noconsolelogger /v:diag /p:Configuration=PRE-PROD</buildArgs>
            <targets>Build</targets>
            <timeout>9000</timeout>
            <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
        </msbuild>

    
        <!-- create package for PRE-PROD env -->
        <exec>
            <executable>cmd.exe</executable>
            <buildArgs>/c "if exist C:\SVN_Working_Directory\Esselte\Esselte_Stable_NB\Package del C:\SVN_Working_Directory\Esselte\Esselte_Stable_NB\Package\PRE-PROD\*.* /Q /F"</buildArgs>
        </exec>
        <msbuild>
            <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
            <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB</workingDirectory>
            <projectFile>website\website.csproj</projectFile>
			 <dynamicValues>
            <replacementValue property="buildArgs">
              <format>/noconsolelogger /v:diag  /t:Package /p:PackageLocation="c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB\Package\PRE-PROD\{0}\Esselte.Website-PRE-PROD-{0}.zip" /p:Configuration=PRE-PROD</format>
              <parameters>
                <namedValue name="$CCNetLabel" value="Default" />
              </parameters>
            </replacementValue>
          </dynamicValues>            
            <targets>Package</targets>
            <timeout>9000</timeout>
            <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
        </msbuild>
        
		<msbuild>
            <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
            <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB</workingDirectory>
            <projectFile>commerce\commerce.csproj</projectFile>            
			<dynamicValues>
            <replacementValue property="buildArgs">
              <format>/noconsolelogger /v:diag /t:Package /p:PackageLocation="c:\SVN_Working_Directory\Esselte\Esselte_Stable_NB\Package\PRE-PROD\{0}\Esselte.Commerce-PRE-PROD-{0}.zip" /p:Configuration=PRE-PROD</format>
              <parameters>
                <namedValue name="$CCNetLabel" value="Default" />
              </parameters>
            </replacementValue>
          </dynamicValues>            
            <targets>Package</targets>
            <timeout>9000</timeout>
            <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
        </msbuild>
			
    </tasks>
</project>
