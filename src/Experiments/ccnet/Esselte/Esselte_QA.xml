<?xml version="1.0" encoding="windows-1250"?>
<project name="Esselte - Deploy QA">
    <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_QA</workingDirectory>
    <artifactDirectory>c:\CCNet_Artefacts_Directory\Esselte\Esselte_QA</artifactDirectory>
    <webURL>http://vmp-ccnet.fcuk.local/server/local/project/Esselte - Deploy QA/ViewProjectReport.aspx</webURL>
    <category>Internal Deployment</category>

    <labeller type="assemblyVersionLabeller">
        <major>1</major>
        <minor>0</minor>
        <build>0</build>
        <incrementOnFailure>false</incrementOnFailure>
    </labeller>

    <publishers>
        <xmllogger logDir="buildlogs" />
        <artifactcleanup cleanUpMethod="KeepLastXBuilds" cleanUpValue="50" />
        <rss items="50" />
    </publishers>

    <sourcecontrol type="svn">
        <trunkUrl>svn://vm-svn.fcdev.local/enp/trunk/Esselte Stable</trunkUrl>
        <username>dev.tools</username>
        <password>KL129377</password>
        <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_QA</workingDirectory>
        <executable>C:\Program Files\CollabNet\Subversion Client\svn.exe</executable>
    </sourcecontrol>

    <tasks>

        <!-- build web application -->
        <msbuild>
            <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
            <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_QA</workingDirectory>
            <projectFile>Esselte.Stable.sln</projectFile>
            <buildArgs>/noconsolelogger /v:diag /p:ReferencePath="C:\SVN_Working_Directory\Esselte\Esselte_QA\Lib"</buildArgs>
            <targets>Build</targets>
            <timeout>900</timeout>
            <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
        </msbuild>


        <!-- build project using QA configuration to generate config transformations-->
        <msbuild>
            <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
            <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_QA</workingDirectory>
            <projectFile>Esselte.Stable.sln</projectFile>
            <buildArgs>/noconsolelogger /v:diag /p:ReferencePath="C:\SVN_Working_Directory\Esselte\Esselte_QA\Lib" /p:Configuration=Release</buildArgs>
            <targets>Build</targets>
            <timeout>900</timeout>
            <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
        </msbuild>

    
        <!-- create package for QA env -->
        <exec>
            <executable>cmd.exe</executable>
            <buildArgs>/c "if exist C:\SVN_Working_Directory\Esselte\Esselte_QA\Package del C:\SVN_Working_Directory\Esselte\Esselte_QA\Package\*.* /Q /F"</buildArgs>
        </exec>
        <msbuild>
            <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
            <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_QA</workingDirectory>
            <projectFile>website\website.csproj</projectFile>
            <buildArgs>/noconsolelogger /v:diag /p:ReferencePath="C:\SVN_Working_Directory\Esselte\Esselte_QA\Lib" /t:Package /p:PackageLocation="c:\SVN_Working_Directory\Esselte\Esselte_QA\Package\Esselte_QA.Web.zip" /p:Configuration=Release</buildArgs>
            <targets>Package</targets>
            <timeout>900</timeout>
            <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
        </msbuild>
        
		<msbuild>
            <executable>C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe</executable>
            <workingDirectory>c:\SVN_Working_Directory\Esselte\Esselte_QA</workingDirectory>
            <projectFile>commerce\commerce.csproj</projectFile>
            <buildArgs>/noconsolelogger /v:diag /p:ReferencePath="C:\SVN_Working_Directory\Esselte\Esselte_QA\Lib" /t:Package /p:PackageLocation="c:\SVN_Working_Directory\Esselte\Esselte_QA\Package\Esselte.CommerceManager_QA.Web.zip" /p:Configuration=Release</buildArgs>
            <targets>Package</targets>
            <timeout>900</timeout>
            <logger>C:\Program Files (x86)\CruiseControl.NET\server\ThoughtWorks.CruiseControl.MSBuild.dll</logger>
        </msbuild>
		
        <!-- deploy the package -->
        <exec>
            <executable>c:\SVN_Working_Directory\Esselte\Esselte_QA\Package\Esselte_QA.Web.deploy.cmd</executable>
            <buildArgs>/y /m:172.21.2.68</buildArgs>
            <buildTimeoutSeconds>6000</buildTimeoutSeconds>
        </exec>

        <exec>
            <executable>c:\SVN_Working_Directory\Esselte\Esselte_QA\Package\Esselte_QA.Web.deploy.cmd</executable>
            <buildArgs>/y /m:172.21.2.69</buildArgs>
            <buildTimeoutSeconds>6000</buildTimeoutSeconds>
        </exec>
        
		<exec>
            <executable>c:\SVN_Working_Directory\Esselte\Esselte_QA\Package\Esselte.CommerceManager_QA.Web.deploy.cmd</executable>
            <buildArgs>/y /m:172.21.2.68</buildArgs>
            <buildTimeoutSeconds>6000</buildTimeoutSeconds>
        </exec>
        <exec>
            <executable>c:\SVN_Working_Directory\Esselte\Esselte_QA\Package\Esselte.CommerceManager_QA.Web.deploy.cmd</executable>
            <buildArgs>/y /m:172.21.2.69</buildArgs>
            <buildTimeoutSeconds>6000</buildTimeoutSeconds>
        </exec>
		
    </tasks>
</project>
